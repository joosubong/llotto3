<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuckyStat 2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- ìƒë‹¨ í—¤ë” -->
    <header class="bg-white shadow-md sticky top-0 z-40">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <h1 class="text-2xl font-bold text-indigo-600">ğŸ² LuckyStat 2.0</h1>
                </div>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="container mx-auto px-4 py-8">
        <!-- ì§€ë‚œ íšŒì°¨ ë³´ê¸° ì„¹ì…˜ -->
        <section class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div id="winningNumbers" class="flex items-center gap-2"></div>
                <button 
                    onclick="uiManager.renderLastWeekModal()" 
                    class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-lg transition-colors"
                >
                    ì§€ë‚œ íšŒì°¨ ë³´ê¸°
                </button>
            </div>
        </section>

        <!-- ì¹´ìš´íŠ¸ë‹¤ìš´ ì„¹ì…˜ -->
        <section class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <div id="countdownContainer"></div>
        </section>

        <!-- ê²°ê³¼ ì„¹ì…˜ -->
        <section class="mb-8">
            <div class="text-center mb-6">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">ìƒì„±ëœ ë¡œë˜ ë²ˆí˜¸</h2>
                <p class="text-gray-600">í†µê³„ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±ëœ 10ê°œì˜ ë²ˆí˜¸ ì¡°í•©</p>
            </div>
            <div id="resultsContainer" class="mb-6">
                <!-- ê²°ê³¼ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë Œë”ë§ë©ë‹ˆë‹¤ -->
            </div>
        </section>

        <!-- ì§ì ‘ ë§Œë“œëŠ” ë²ˆí˜¸ ì„¹ì…˜ -->
        <section class="mb-8">
            <div class="text-center mb-6">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">ì§ì ‘ ë§Œë“œëŠ” ë²ˆí˜¸</h2>
                <p class="text-gray-600">ì›í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë²ˆí˜¸ë¥¼ ì§ì ‘ ìƒì„±í•˜ì„¸ìš”</p>
            </div>
            
            <!-- ìƒì„± ì˜µì…˜ ì„ íƒ -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                    <div class="flex items-center gap-3 p-4 border-2 border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                        <input type="checkbox" value="random" id="random_check" class="w-5 h-5 text-indigo-600" checked>
                        <label for="random_check" class="flex-1 font-medium text-gray-700 cursor-pointer">ëœë¤ìœ¼ë¡œ ìƒì„±</label>
                        <input type="number" id="random_count" value="1" min="1" max="50" class="w-16 px-2 py-1 border border-gray-300 rounded text-center text-sm">
                    </div>
                    <div class="flex items-center gap-3 p-4 border-2 border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                        <input type="checkbox" value="weighted" id="weighted_check" class="w-5 h-5 text-indigo-600" checked>
                        <label for="weighted_check" class="flex-1 font-medium text-gray-700 cursor-pointer">í†µê³„ê¸°ë°˜</label>
                        <input type="number" id="weighted_count" value="1" min="1" max="50" class="w-16 px-2 py-1 border border-gray-300 rounded text-center text-sm">
                    </div>
                    <div class="flex items-center gap-3 p-4 border-2 border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                        <input type="checkbox" value="weighted_consecutive" id="weighted_consecutive_check" class="w-5 h-5 text-indigo-600" checked>
                        <label for="weighted_consecutive_check" class="flex-1 font-medium text-gray-700 cursor-pointer">í†µê³„ + ì—°ì† 2ìë¦¬ìˆ˜</label>
                        <input type="number" id="weighted_consecutive_count" value="1" min="1" max="50" class="w-16 px-2 py-1 border border-gray-300 rounded text-center text-sm">
                    </div>
                    <div class="flex items-center gap-3 p-4 border-2 border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                        <input type="checkbox" value="exclude_bottom" id="exclude_bottom_check" class="w-5 h-5 text-indigo-600" checked>
                        <label for="exclude_bottom_check" class="flex-1 font-medium text-gray-700 cursor-pointer">í†µê³„ í•˜ìœ„ 15ê°œ ì œì™¸</label>
                        <input type="number" id="exclude_bottom_count" value="1" min="1" max="50" class="w-16 px-2 py-1 border border-gray-300 rounded text-center text-sm">
                    </div>
                </div>
                <div class="text-center flex gap-4 justify-center">
                    <button 
                        onclick="generateSelectedNumbers()" 
                        class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg transition-colors text-lg"
                    >
                        ìƒì„±
                    </button>
                    <button 
                        onclick="resetCustomResults()" 
                        class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-8 rounded-lg transition-colors text-lg"
                    >
                        ì´ˆê¸°í™”
                    </button>
                </div>
            </div>
            
            <!-- ìƒì„± ê²°ê³¼ í‘œì‹œ -->
            <div id="customResultsContainer" class="bg-white rounded-lg shadow-lg p-6">
                <div class="text-center text-gray-500">
                    <p>ìœ„ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë²ˆí˜¸ë¥¼ ìƒì„±í•˜ì„¸ìš”.</p>
                </div>
            </div>
        </section>

    </main>

    <!-- í‘¸í„° -->
    <footer class="bg-gray-800 text-white text-center py-4 mt-8">
        <div class="container mx-auto px-4">
            <p class="text-sm">Â© 2024 LuckyStat 2.0 - í†µê³„ ê¸°ë°˜ ë¡œë˜ ë²ˆí˜¸ ìƒì„±ê¸°</p>
        </div>
    </footer>

    <!-- ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="js/data.js"></script>
    <script src="js/generate.js"></script>
    <script src="js/schedule.js"></script>
    <script src="js/ui.js"></script>
    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            // UI ì´ˆê¸°í™”
            uiManager.init();
            
            // ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
            uiManager.renderCountdown('countdownContainer');
            
            // ë°ì´í„° ë™ê¸°í™” í›„ ê²°ê³¼ ë¡œë“œ ë° í‘œì‹œ (ì£¼ì°¨ í™•ì¸)
            (async () => {
                try {
                    // ê³µìš© ë°ì´í„° ë™ê¸°í™” (ë¹„ë™ê¸°)
                    const data = await dataManager.loadData();
                    
                    const resultsData = dataManager.loadResults();
                    const currentWeekInfo = numberGenerator.getCurrentWeekNumber();
                    
                    // ì£¼ì°¨ê°€ ë°”ë€Œì—ˆëŠ”ì§€ í™•ì¸
                    let shouldRegenerate = false;
                    if (!resultsData || !resultsData.results) {
                        // ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
                        shouldRegenerate = true;
                    } else if (!resultsData.weekInfo) {
                        // ì£¼ì°¨ ì •ë³´ê°€ ì—†ìœ¼ë©´ (ì´ì „ ë²„ì „ í˜¸í™˜) ìƒˆë¡œ ìƒì„±
                        shouldRegenerate = true;
                    } else {
                        // ì£¼ì°¨ê°€ ë°”ë€Œì—ˆëŠ”ì§€ í™•ì¸
                        const savedWeekInfo = resultsData.weekInfo;
                        if (savedWeekInfo.weekNumber !== currentWeekInfo.weekNumber || 
                            savedWeekInfo.year !== currentWeekInfo.year) {
                            // ì£¼ì°¨ê°€ ë°”ë€Œì—ˆìœ¼ë©´ ìƒˆë¡œ ìƒì„±
                            shouldRegenerate = true;
                        }
                    }
                    
                    if (shouldRegenerate) {
                        // ìƒˆ ë²ˆí˜¸ ìƒì„±
                        const newResults = numberGenerator.generate(data);
                        dataManager.saveResults(newResults, currentWeekInfo);
                        uiManager.renderResults(newResults, 'resultsContainer');
                    } else {
                        // ê¸°ì¡´ ê²°ê³¼ í‘œì‹œ
                        uiManager.renderResults(resultsData.results, 'resultsContainer');
                    }
                } catch (error) {
                    console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                    // ì˜¤ë¥˜ ì‹œ ê¸°ë³¸ ë™ì‘ (ë™ê¸° ë²„ì „ ì‚¬ìš©)
                    const data = dataManager.loadDataSync();
                    const resultsData = dataManager.loadResults();
                    if (resultsData && resultsData.results) {
                        uiManager.renderResults(resultsData.results, 'resultsContainer');
                    } else {
                        // ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ìƒì„±
                        const newResults = numberGenerator.generate(data);
                        const currentWeekInfo = numberGenerator.getCurrentWeekNumber();
                        dataManager.saveResults(newResults, currentWeekInfo);
                        uiManager.renderResults(newResults, 'resultsContainer');
                    }
                }
            })();
            
            // ë‹¹ì²¨ë²ˆí˜¸ í‘œì‹œ
            uiManager.renderWinningNumbers('winningNumbers');
            
            // ìŠ¤ì¼€ì¤„ ì‹œì‘
            scheduleManager.start((formatted, remaining) => {
                uiManager.renderCountdown('countdownContainer');
            });
        });

        // ë²ˆí˜¸ë³„ í†µê³„ ë°ì´í„° (1~1195íšŒì°¨ ê¸°ì¤€)
        const numberStatsData = [
            { number: 34, percent: 100, count: 204 },
            { number: 27, percent: 99, count: 202 },
            { number: 12, percent: 99, count: 202 },
            { number: 33, percent: 99, count: 201 },
            { number: 13, percent: 99, count: 201 },
            { number: 17, percent: 98, count: 199 },
            { number: 3, percent: 97, count: 198 },
            { number: 43, percent: 96, count: 196 },
            { number: 7, percent: 96, count: 195 },
            { number: 6, percent: 96, count: 195 },
            { number: 1, percent: 95, count: 194 },
            { number: 37, percent: 95, count: 194 },
            { number: 20, percent: 95, count: 194 },
            { number: 38, percent: 95, count: 193 },
            { number: 4, percent: 94, count: 192 },
            { number: 24, percent: 94, count: 191 },
            { number: 40, percent: 94, count: 191 },
            { number: 26, percent: 94, count: 191 },
            { number: 16, percent: 93, count: 190 },
            { number: 31, percent: 93, count: 190 },
            { number: 14, percent: 93, count: 190 },
            { number: 18, percent: 93, count: 190 },
            { number: 11, percent: 92, count: 188 },
            { number: 45, percent: 92, count: 188 },
            { number: 35, percent: 92, count: 187 },
            { number: 19, percent: 92, count: 187 },
            { number: 21, percent: 92, count: 187 },
            { number: 39, percent: 91, count: 186 },
            { number: 15, percent: 91, count: 186 },
            { number: 2, percent: 90, count: 184 },
            { number: 10, percent: 90, count: 184 },
            { number: 36, percent: 90, count: 183 },
            { number: 44, percent: 89, count: 182 },
            { number: 30, percent: 89, count: 182 },
            { number: 42, percent: 86, count: 176 },
            { number: 8, percent: 86, count: 176 },
            { number: 5, percent: 85, count: 174 },
            { number: 28, percent: 85, count: 174 },
            { number: 32, percent: 85, count: 173 },
            { number: 29, percent: 82, count: 167 },
            { number: 25, percent: 82, count: 167 },
            { number: 23, percent: 80, count: 164 },
            { number: 41, percent: 79, count: 161 },
            { number: 22, percent: 78, count: 160 },
            { number: 9, percent: 76, count: 156 }
        ];

        // êµ¬ê°„ë³„ ì¶œí˜„ íšŸìˆ˜ ë°ì´í„° (1~1195íšŒì°¨ ê¸°ì¤€)
        const rangeStatsData = [
            { range: '1-5', percent: 92, count: 12 },
            { range: '6-10', percent: 85, count: 11 },
            { range: '11-15', percent: 100, count: 13 },
            { range: '16-20', percent: 100, count: 13 },
            { range: '21-25', percent: 100, count: 13 },
            { range: '26-30', percent: 100, count: 13 },
            { range: '31-35', percent: 92, count: 12 },
            { range: '36-40', percent: 100, count: 13 },
            { range: '41-45', percent: 38, count: 5 }
        ];

        // í†µê³„ ë°ì´í„°ë¥¼ numberStats í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (êµ¬ê°„ë³„ í†µê³„ í¬í•¨)
        function convertStatsToNumberStats(statsData, rangeStats) {
            const numberStats = {};
            
            // ë²ˆí˜¸ë³„ í†µê³„ ë°ì´í„° ë³€í™˜
            statsData.forEach(item => {
                numberStats[item.number.toString()] = item.count;
            });
            
            // êµ¬ê°„ë³„ í†µê³„ë¥¼ ë²ˆí˜¸ë³„ í†µê³„ì— ì¶”ê°€
            rangeStats.forEach(rangeItem => {
                const [start, end] = rangeItem.range.split('-').map(Number);
                const rangeCount = rangeItem.count;
                const numbersInRange = end - start + 1; // êµ¬ê°„ ë‚´ ë²ˆí˜¸ ê°œìˆ˜
                const additionalWeight = rangeCount / numbersInRange; // êµ¬ê°„ë³„ ì¶œí˜„ íšŸìˆ˜ë¥¼ êµ¬ê°„ ë‚´ ë²ˆí˜¸ ê°œìˆ˜ë¡œ ë‚˜ëˆ”
                
                // í•´ë‹¹ êµ¬ê°„ì˜ ëª¨ë“  ë²ˆí˜¸ì— ê°€ì¤‘ì¹˜ ì¶”ê°€
                for (let num = start; num <= end; num++) {
                    const numKey = num.toString();
                    if (numberStats[numKey]) {
                        numberStats[numKey] += additionalWeight;
                    } else {
                        numberStats[numKey] = additionalWeight;
                    }
                }
            });
            
            return numberStats;
        }

        // ì„ íƒëœ ë°©ì‹ìœ¼ë¡œ ë²ˆí˜¸ ìƒì„±
        function generateSelectedNumbers() {
            // ì„ íƒëœ ì²´í¬ë°•ìŠ¤ ê°€ì ¸ì˜¤ê¸°
            const checkboxes = document.querySelectorAll('input[type="checkbox"][value]:checked');
            
            if (checkboxes.length === 0) {
                alert('ìµœì†Œ í•˜ë‚˜ ì´ìƒì˜ ìƒì„± ë°©ì‹ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            // í†µê³„ ë°ì´í„°ë¥¼ numberStats í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (êµ¬ê°„ë³„ í†µê³„ í¬í•¨)
            const numberStats = convertStatsToNumberStats(numberStatsData, rangeStatsData);
            
            // ê²°ê³¼ í‘œì‹œ
            const container = document.getElementById('customResultsContainer');
            container.innerHTML = '';
            
            const innerContainer = document.createElement('div');
            innerContainer.className = 'flex flex-col gap-4';
            
            // ê° ì„ íƒëœ ë°©ì‹ì— ëŒ€í•´ ë²ˆí˜¸ ìƒì„±
            let resultIndex = 0;
            checkboxes.forEach((checkbox) => {
                const type = checkbox.value;
                // ê°œìˆ˜ ì…ë ¥ í•„ë“œì—ì„œ ê°’ ê°€ì ¸ì˜¤ê¸°
                const countInput = document.getElementById(`${type}_count`);
                const count = parseInt(countInput.value) || 1;
                
                // ì„¤ì •ëœ ê°œìˆ˜ë§Œí¼ ë²ˆí˜¸ ìƒì„±
                for (let i = 0; i < count; i++) {
                    let numbers = [];

                    switch(type) {
                        case 'random':
                            // ëœë¤ìœ¼ë¡œ ìƒì„±
                            numbers = numberGenerator.generateUniqueNumbers(6);
                            break;
                        case 'weighted':
                            // í†µê³„ê¸°ë°˜
                            numbers = numberGenerator.generateWeightedNumbers(6, numberStats);
                            break;
                        case 'weighted_consecutive':
                            // í†µê³„ + ì—°ì† 2ìë¦¬ìˆ˜
                            numbers = numberGenerator.generateWeightedWithConsecutive(6, numberStats);
                            break;
                        case 'exclude_bottom':
                            // í†µê³„ í•˜ìœ„ 15ê°œ ì œì™¸
                            const bottomNumbers = numberGenerator.getBottomNumbers(numberStats, 15);
                            numbers = numberGenerator.generateWeightedNumbers(6, numberStats, bottomNumbers);
                            break;
                    }

                    const numbersContainer = document.createElement('div');
                    numbersContainer.className = 'flex flex-wrap items-center gap-1 justify-center';
                    numbersContainer.id = `customNumbersContainer_${resultIndex}`;
                    
                    // ì›ë³¸ ìƒ‰ìƒ ì •ë³´ ì €ì¥
                    const originalColors = [];
                    
                    numbers.forEach((num, numIndex) => {
                        const numberBadge = uiManager.createNumberBadge(num);
                        numberBadge.dataset.originalColor = numberBadge.className;
                        originalColors.push({
                            element: numberBadge,
                            originalColor: numberBadge.className
                        });
                        numbersContainer.appendChild(numberBadge);
                    });
                    
                    // í™•ì¸ ë²„íŠ¼ (ë²ˆí˜¸ ì˜†ì— ë°°ì¹˜)
                    const checkButton = document.createElement('button');
                    checkButton.className = 'bg-white border border-gray-300 text-gray-700 font-medium py-1 px-2 rounded-lg hover:bg-gray-50 transition-all text-xs';
                    checkButton.textContent = 'í™•ì¸';
                    
                    // í´ë¡œì €ë¡œ ê°’ ì €ì¥
                    const currentIndex = resultIndex;
                    const currentNumbers = [...numbers];
                    const currentContainer = numbersContainer;
                    const originalColorsRef = originalColors;
                    let isGray = false; // í˜„ì¬ ìƒíƒœ ì¶”ì 
                    
                    // í™•ì¸ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (í† ê¸€: íšŒìƒ‰ â†” ì›ë˜ ìƒ‰)
                    checkButton.addEventListener('click', () => {
                        const badges = currentContainer.querySelectorAll('span[data-original-color]');
                        
                        if (!isGray) {
                            // íšŒìƒ‰ìœ¼ë¡œ ë³€ê²½
                            badges.forEach((badge, badgeIndex) => {
                                badge.className = 'inline-flex items-center justify-center w-[30px] h-[30px] rounded-full font-bold text-xs border-2 bg-gray-200 text-gray-700 border-gray-300';
                            });
                            isGray = true;
                            
                            // ë²ˆí˜¸ ë³µì‚¬
                            const numbersText = currentNumbers.join(' ');
                            uiManager.copyToClipboard(numbersText);
                        } else {
                            // ì›ë˜ ìƒ‰ìƒìœ¼ë¡œ ë³µì›
                            badges.forEach((badge, badgeIndex) => {
                                const originalColor = originalColorsRef[badgeIndex].originalColor;
                                badge.className = originalColor;
                            });
                            isGray = false;
                        }
                    });
                    
                    numbersContainer.appendChild(checkButton);
                    innerContainer.appendChild(numbersContainer);
                    resultIndex++;
                }
            });
            
            container.appendChild(innerContainer);
        }

        // ê²°ê³¼ ì´ˆê¸°í™” í•¨ìˆ˜
        function resetCustomResults() {
            const container = document.getElementById('customResultsContainer');
            container.innerHTML = `
                <div class="text-center text-gray-500">
                    <p>ìœ„ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë²ˆí˜¸ë¥¼ ìƒì„±í•˜ì„¸ìš”.</p>
                </div>
            `;
        }
    </script>
</body>
</html>

